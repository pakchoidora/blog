<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
  <title>Todo</title>
  <style>
  .wrapper {
    margin: 35px auto 0;
    max-width: 414px;
  }
  @media (min-width: 768px) {
    .wrapper {
      max-width: 920px;
    }
  }
  body, ul, li {
    padding: 0;
    margin: 0;
  }
  li {
    list-style: none;
  }
  .todo {
    border-radius: 4px;
    border: 1px #eee solid;
    box-shadow: 0 1px 1px rgba(0,0,0,.05);
  }
  .todo .title, .todo .items {
    padding: 10px 15px;
  }
  .item.done {
    text-decoration: line-through;
    opacity: .6;
  }
  .todo>.title {
    background-color: #f5f5f5;
  }
  .item>a {
    text-decoration: none;
    color: #383838;
    display: flex;
    line-height: 20px;
  }
  </style>
</head>
<body>
  <div class="wrapper">
    <div class="content"></div>
  </div>
  <!--
  <script type="text/javascript" src="//http://7xirxu.com1.z0.glb.clouddn.com/libs/zepto/zepto.min.js"></script>
  <script type="text/javascript" src="//7xirxu.com1.z0.glb.clouddn.com/libs/underscore/underscore-min.js"></script>
  <script type="text/javascript" src="//7xirxu.com1.z0.glb.clouddn.com/libs/backbone/backbone-min.js"></script>
  -->
  <script type="text/javascript" src="//localhost/libs/zepto/zepto.js"></script>
  <script type="text/javascript" src="//localhost/libs/underscore/underscore-min.js"></script>
  <script type="text/javascript" src="//localhost/libs/backbone/backbone-min.js"></script>
  <script type="text/javascript">
  Zepto(function($) {
    var TodoApp = Backbone.View.extend({
      initialize: function(title, items) {
        this.setElement(this.template({title: title}));
        this._todoItems = new TodoItems(items);
        this.append(this._todoItems);
        this._todoStatus = new TodoStatus();
        this.append(this._todoStatus);
      },
      template: _.template('\
        <div class="todo">\
          <div class="title"><%=title%></div>\
        </div>\
      '),
      append: function(view) {
        this.$el.append(view.$el || view);
      },
      notify: function(event, model, message) {
        this._todoStatus.message(message);
      }
    });
    var Todos = Backbone.Collection.extend({
      model: Backbone.Model.extend({
        defaults: {
          isDone: false
        },
        initialize: function() {}
      }),
      initialize: function(items) {
        this.parse(items);
      }
    });
    var TodoItem = Backbone.View.extend({
      initialize: function(model) {
        this._model = model;
        this.setElement(this.template(this._model.toJSON()));
        this.listenTo(this._model, 'change', this.render);
      },
      template: _.template('\
        <li class="item<%=isDone?\' done\':\'\'%>">\
          <a href="javascript:void(0);">\
            <div class="check-box">\
              <span class="todo-icon">&nbsp;</span>\
            </div>\
            <div class="todo-content-set">\
              <div class="todo-content"><%=name%></div>\
            </div>\
          </a>\
        </li>\
      '),
      events: {
        'click .check-box': function() {
          if (this.$el.hasClass('done')) {
            this.$el.removeClass('done');
          } else {
            this.$el.addClass('done');
          }
        }
      }
    });
    var TodoItems = Backbone.View.extend({
      initialize: function(items) {
        this._items = new Todos(items);
        this.setElement(this.template());
        var self = this;
        this._items.forEach(function(element) {
          self.$el.append(new TodoItem(element).$el);
        });
      },
      template: _.template('\
        <ul class="items"></ul>\
      ')
    });
    var TodoStatus = Backbone.View.extend({
      initialize: function() {
        this.setElement(this.template());
      },
      template: _.template('\
        <div class="status">\
          <span class="message"></span>\
        </div>\
      '),
      message: function(message) {
        this.$('.message').text(message);
      }
    });
    $(document).ready(function() {
      var items = [
        {name: '好棒', isDone: true},
        {name: '垲蛋好棒'}
      ];
      $('.content').html(new TodoApp('Todo List', items).$el);
    });
  });
  </script>
</body>
</html>